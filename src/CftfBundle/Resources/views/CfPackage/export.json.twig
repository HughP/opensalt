{% block body %}
{
    "lsDoc": {
        "identifier": {{ lsDoc.identifier |json_encode |raw }},
        "uri": {{ lsDoc.uri|local_uri |json_encode |raw }},
        "creator": {{ lsDoc.creator |json_encode |raw }},
        "title": {{ lsDoc.title |json_encode |raw }},
        {% if lsDoc.officialUri is not null %}
        "officialSourceURL": {{ lsDoc.officialUri|local_remote_uri |json_encode |raw }},
        {% endif %}
        {% if lsDoc.publisher is not null %}
        "publisher": {{ lsDoc.publisher |json_encode |raw }},
        {% endif %}
        {% if lsDoc.description is not null %}
        "description": {{ lsDoc.description |json_encode |raw }},
        {% endif %}
        {% if subjects is not empty %}
            "subject": "{% for subject in lsDoc.subjects %}{% if not loop.first %}|{% endif %}{{ subject.title }}{% endfor %}",
            "subjectURI": [
                {% for subject in lsDoc.subjects %}
                    {% if not loop.first %},{% endif %}
                    {
                        "title": {{ subject.title |json_encode |raw }},
                        "identifier": {{ subject.identifier |json_encode |raw }},
                        "uri": {{ subject.uri|local_remote_uri |json_encode |raw }}
                    }
                {% endfor %}
            ],
        {% endif %}
        {% if lsDoc.language is not null %}
        "language": {{ lsDoc.language |json_encode |raw }},
        {% endif %}
        {% if lsDoc.version is not null %}
        "version": {{ lsDoc.version |json_encode |raw }},
        {% endif %}
        {% if lsDoc.adoptionStatus is not null %}
        "adoptionStatus": {{ lsDoc.adoptionStatus |json_encode |raw }},
        {% endif %}
        {% if lsDoc.statusStart is not null %}
        "statusStartDate": {{ lsDoc.statusStart |json_encode |raw }},
        {% endif %}
        {% if lsDoc.statusEnd is not null %}
        "statusEndDate": {{ lsDoc.statusEnd |json_encode |raw }},
        {% endif %}
{# TODO: license and licenseURI #}
        {% if lsDoc.note is not null %}
        "notes": {{ lsDoc.note |json_encode |raw }},
        {% endif %}
        "lastChangeDateTime": {{ lsDoc.updatedAt|date('c') |json_encode |raw }},
{# TODO: CFPackage URI #}
        "CFPackageURI": {{ lsDoc.uri|local_uri |json_encode |raw }}
    },
    "lsItems": [
    {% for item in items %}
        {% if not loop.first %},{% endif %}
        {# render_esi(path('lsitem_export', { 'id': item.id })) #}
        {% include 'CftfBundle:CfPackage:export_item.json.twig' with { 'lsItem':item, 'lsDoc':lsDoc } %}
    {% endfor %}
    ],
    "lsAssociations": [
    {% for association in associations %}
        {% if not loop.first %},{% endif %}
        {# render_esi(path('lsitem_export', { 'id': item.id })) #}
        {% include 'CftfBundle:CfPackage:export_association.json.twig' with { 'lsAssociation':association, 'lsDoc':lsDoc } %}
    {% endfor %}
    ],
    "definitions": {
        "lsItemTypes": [
        {% for itemType in itemTypes %}
            {% if not loop.first %},{% endif %}
            {# render_esi(path('lsitem_export', { 'id': item.id })) #}
            {% include 'CftfBundle:CfPackage:export_item_type.json.twig' with { 'lsItemType':itemType } %}
        {% endfor %}
        ]
        {% if subjects is not empty %}
        ,"lsSubjects": [
            {% for subject in subjects %}
                {% if not loop.first %},{% endif %}
                {
                    "title": {{ subject.title |json_encode |raw }}
                    ,"identifier": {{ subject.identifier |json_encode |raw }}
                    ,"uri": {{ subject.uri|local_remote_uri |json_encode |raw }}
                    {% if subject.description is not empty %}
                    ,"description": {{ subject.description |json_encode |raw }}
                    {% endif %}
                    {% if subject.hierarchyCode is not empty %}
                    ,"hierarchyCode": {{ subject.hierarchyCode |json_encode |raw }}
                    {% endif %}
                }
            {% endfor %}
        {% endif %}
        ]
        {% if concepts is not empty %}
        ,"lsConcepts": [
        ]
        {% endif %}
        {% if licences is not empty %}
        ,"lsLicenses": [
        ]
        {% endif %}
        {% if associationGroupings is not empty %}
        ,"lsAssociationGroupings": [
        ]
        {% endif %}
    }
}
{% endblock %}

