{% extends 'base.html.twig' %}

{% block body %}
    {% if is_granted('create', 'lsdoc') %}
        <div class="panel panel-default">
            <div class= "panel-heading">
                Repositories list
            </div>
            <div class="panel-body js-github-list">
                <p class="js-github-message-error" style="display: none;">Something went wrong while we are getting github information or you have not signed in with Github, do it <a href="{{ path('github_login') }}">here</a>.</p>
                <p class="js-github-message-loading">Loading...</p>
            </div>
        </div>
    {% endif %}

    <h1>Competency Frameworks
        {% if is_granted('create', 'lsdoc') %}
            <ul class="list-inline pull-right">
                <li>
                    <a class="btn btn-default" href="{{ path('lsdoc_new') }}">Create a new Framework</a>
                </li>
            </ul>
        {% endif %}
    </h1>

    <div id="competencyTree">
        {% set lastCreator = '' %}
        <ul id="comptencyTreeData" style="display:none;">
        {% for framework in lsDocs %}
            {% if framework.creator != lastCreator %}
                {% if not loop.first %}
                </ul></li>
                {% endif %}
                <li class="folder expanded">{{ framework.creator }}<ul>
                {% set lastCreator = framework.creator %}
            {% endif %}
            <li class="salt-framework-link"><a href="{{ path('editor_lsdoc', { 'id': framework.id }) }}">{{ framework.title }}</a></li>
            {% if loop.last == true %}
                </ul></li>
            {% endif %}
        {% endfor %}
        </ul>
    </div>
{% endblock %}

{% block javascripts %}
    <script>
        $('#competencyTree').fancytree({
            activate: function(event, data){
                var node = data.node;
                if (!$.isEmptyObject(node.data)) {
                    if (undefined != node.data.href)
                    window.location.href = node.data.href;
                }
            }
        });
    </script>
{% endblock %}
